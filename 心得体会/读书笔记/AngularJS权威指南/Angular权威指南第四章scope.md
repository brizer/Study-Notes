# Angular权威指南第四章scope



---

##**前言**
本章主要介绍了作用域的基本概念和生命周期。

---

作用域是视图和控制器之间的胶水。在应用将视图渲染并呈现给用户之前，视图中的模板会和作用域进行连接，然后应用会对DOM进行设置以便将属性变化通知给Angular。
我们可以**依赖视图在修改数据时立刻更新`$scope`**，也可以**依赖`$scope`在其发生变化时立刻重新渲染视图**。

AngularJS将`$scope`设计成和DOM类似的结构,因此**`$scope`可以进行嵌套**，也就是说我们可以引用父级`$scope`中的属性。

我们可以将应用的业务逻辑都放在控制器中，而将**相关的数据都放在控制器的作用域中**。

---

##**视图和`$scope`**
AngularJS启动并生成视图时，会将根ng-app元素同`$rootScope`进行绑定，**`$rootScope`是所有`$scope`对象的最上层**。所以我们在`$rootScope`上附加太多业务逻辑不太明智。

其实$scope就是一个普通的对象，我们可以在其上**随意修改或添加属性**。`$scope`所有的属性，都可以**自动被视图访问到**：

    <div ng-app="myApp">
      <h1>Hello {{ name }}</h1><!-- Hello World -->
    </div>
    <script>
      angular.module('myApp',[])
        .run(function($rootScope){
          $rootScope.name = "World";
        });
    </script>

我们定义一个叫做myApp的模块，在其中的`$rootScope`上添加属性name，就可以通过模板得到结果。

---
##**作用域的作用**

基本功能如下：
1. 提供观察者以监视数据模型的变化；
2. 可以将数据模型的变化通知给整个应用，甚至是系统外的组件；
3. 可以进行**嵌套、隔离业务功能和数据**；
4. 给表达式提供运算时所需的执行环境。

就拿上面的例子来说，我们可以不将变量设置在`$rootScope`上，而是用控制器**显式创建一个隔离的子`$scope`对象**，把变量设置到这个子对象上：

    <div ng-app="myApp">
      <div ng-controller="MyController">
      	<h1>Hello {{ name }}</h1><!-- Hello LiuFang -->
      </div>
    </div>
    <script>
      angular.module('myApp',[])
        .controller('MyController',
        function($scope){
          $scope.name = "LiuFang";
        });
    </script>

**ng-controller指令为这个DOM元素创建一个新的`$scope`对象，并将它嵌套在`$rootScope`中**。

---

##**`$scope`的生命周期**

Angualr的事件循环会**在特定情况下启动**，比如用户通过ng-model属性监控的输入字段中输入，或者带有ng-click属性的按钮被点击时。

每当事件被处理时，`$scope`就会对定义的表达式求值。此时事件循环会启动，并且Angular应用会**监控应用程序内的所有对象，脏检测循环也会运行**。

`$scope`对象的生命周期处理有四个不同阶段。

###**创建**

在创建控制器或指令时，AngularJS会用$injector创建一个新的作用域，并在这个新建的控制器或指令运行时**将作用域传递进去**。

###**链接**

当AngluarJS开始运行时，所有的`$scope`对象都会附加或者链接到视图中。所有创建**`$scope`**对象的函数也会将自身附加到视图中。这些作用域将会注册当Angular应用上下文中发生变化时需要运行的`$watch`函数,Angular通过这些函数获知何时启动事件循环。

###**更新**

当事件循环运行时，它通常执行在顶层`$scope`对象上（也就是`$rootScope`）,每个子作用域都执行自己的脏值检测。每个监控函数都会检测变化，如果检测到任意变化，`$scope`对象就会触发指定的回调函数。

###**销毁**

当一个**`$scope`**在视图中不再需要时，这个作用域将会清理和销毁自己。我们也可以使用这个**`$scope`**上叫做**`$destory()`**的方法来清理这个作用域。

##**指令的作用域**

指令在AngularJS中被广泛使用，指令通常不会创建自己的`$scope`,但是也有例外，比如ng-controller和ng-repeat指令会**创建自己的子作用域并将它们附加到DOM元素**上。


---

##**感悟**

Angular通过将各个控制器的作用域独立管理来实现低耦合。
这一章的概念偏多，需要多理解。下一章详细学习控制器，代码的运用就会多起来呢。

